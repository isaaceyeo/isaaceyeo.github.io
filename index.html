<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Franchise Compliance Checker</title>

    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

    <style>
        :root {
            --red: #CC4B4B;
            --offwhite: #F3F8EE;
            --teal: #B9DCD5;
            --steel: #5A85A0;
            --navy: #1E324F;
            --green: #4CAF50;
            --yellow: #E6C447;
        }

        body {
            font-family: "Inter", sans-serif;
            background: var(--offwhite);
            margin: 0;
            padding: 40px;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 850px;
            background: white;
            border-radius: 16px;
            padding: 40px 50px;
            border-top: 12px solid var(--navy);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        h1 {
            text-align: center;
            color: var(--navy);
            margin-bottom: 20px;
            font-size: 34px;
            letter-spacing: -0.5px;
        }

        #fileInput {
            margin-top: 12px;
            padding: 12px;
            background: var(--teal);
            border-radius: 8px;
        }

        #analyzeBtn {
            margin-top: 20px;
            padding: 14px 26px;
            background: var(--navy);
            color: white;
            border-radius: 10px;
            border: none;
            font-size: 17px;
            cursor: pointer;
        }

        #loading {
            margin-top: 15px;
            display: none;
            color: var(--steel);
            font-size: 15px;
        }

        .results-section {
            margin-top: 40px;
        }

        .score-box {
            background: var(--offwhite);
            padding: 20px;
            border-radius: 12px;
        }

        .progressbar-bg {
            width: 100%;
            background: #ddd;
            height: 12px;
            border-radius: 6px;
            margin-top: 10px;
        }

        .progressbar-fill {
            height: 12px;
            background: var(--green);
            width: 0%;
            border-radius: 6px;
        }

        .risk-badge {
            margin-top: 15px;
            display: inline-block;
            padding: 8px 14px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
        }

        .risk-low { background: var(--green); }
        .risk-med { background: var(--yellow); }
        .risk-high { background: var(--red); }

        .item-grid {
            margin-top: 30px;
        }

        .item {
            background: white;
            border: 1px solid #ddd;
            padding: 14px;
            border-radius: 10px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
        }

        .found { color: var(--green); font-weight: bold; }
        .missing { color: var(--red); font-weight: bold; }

        #signBtn {
            width: 100%;
            padding: 16px;
            margin-top: 30px;
            border-radius: 10px;
            border: none;
            background: grey;
            color: white;
            font-size: 18px;
        }

        #signBtn.enabled {
            background: var(--green);
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="container">

    <h1>Franchise Disclosure Compliance Checker</h1>

    <h2>Upload Your Document</h2>
    <input type="file" id="fileInput" accept=".pdf,.txt">
    <button id="analyzeBtn">Analyze Document</button>
    <div id="loading">Extracting PDF text... Please wait.</div>

    <div id="results" class="results-section"></div>

</div>

<script>
/* ------------- CHECKLIST ITEMS (EXACT FROM RESULTS PAGE) ---------------- */
const checklistItems = [
    {
        id: "consideration",
        label: "Fees & Royalties (Consideration of the Parties)",
        keywords: ["fee","fees","royalty","royalties","franchise fee","initial fee","payment"]
    },
    {
        id: "conduct",
        label: "Conduct of the Business",
        keywords: [
            "conduct of the business",
            "operational standards",
            "operating standards",
            "operations manual",
            "store appearance",
            "approved location",
            "store design",
            "approved suppliers",
            "site selection",
            "operating requirements",
            "quality control standards"
        ]
    },
    {
        id: "termination",
        label: "Termination of the Agreement",
        keywords: ["termination","terminate","end of this agreement","expiry","cancel this agreement"]
    },
    {
        id: "restrictive",
        label: "Restrictive Covenants (Non-Competition)",
        keywords: ["restrictive covenant","non-compete","non competition","not compete"]
    },
    {
        id: "ip",
        label: "Intellectual Property Rights",
        keywords: ["intellectual property","trademark","trademarks","logo","brand","proprietary system"]
    },
    {
        id: "disclosure",
        label: "Disclosure of Material Facts",
        keywords: ["material fact","material facts","full disclosure","disclosure document","arthur wishart"]
    },
    {
        id: "goodfaith",
        label: "Duty of Fair Dealing / Good Faith",
        keywords: ["good faith","fair dealing","act honestly"]
    },
    {
        id: "associate",
        label: "Right to Associate",
        keywords: ["right to associate","franchisee association","association of franchisees"]
    }
];

/* -------------------- ANALYSIS FUNCTION (EXACT) -------------------- */
document.getElementById("analyzeBtn").onclick = async function () {
    const file = document.getElementById("fileInput").files[0];
    if (!file) { alert("Upload a file first."); return; }

    document.getElementById("loading").style.display = "block";

    let text = "";

    if (file.type === "text/plain") {
        text = await file.text();
    } else {
        const buffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;

        for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const content = await page.getTextContent();
            text += content.items.map(i => i.str).join(" ") + "\n";
        }
    }

    text = text.toLowerCase();

    const resultsMap = {};
    checklistItems.forEach(item => {
        resultsMap[item.id] = item.keywords.some(kw => text.includes(kw.toLowerCase()));
    });

    renderResults(resultsMap);
};

/* -------------------- RENDER FUNCTION (EXACT) -------------------- */
function renderResults(results) {
    const container = document.getElementById("results");
    container.innerHTML = "";

    let found = Object.values(results).filter(v => v).length;
    let total = checklistItems.length;

    let riskClass =
        found === total ? "risk-low" :
        found >= total * 0.5 ? "risk-med" :
        "risk-high";

    let riskLabel =
        found === total ? "Low Risk" :
        found >= total * 0.5 ? "Medium Risk" :
        "High Risk";

    let html = `
        <div class="score-box">
            <h3>Compliance Score: ${found} / ${total}</h3>

            <div class="progressbar-bg">
                <div class="progressbar-fill" style="width: ${(found/total)*100}%"></div>
            </div>

            <div class="risk-badge ${riskClass}">${riskLabel}</div>
        </div>

        <div class="item-grid">
    `;

    checklistItems.forEach(item => {
        html += `
            <div class="item">
                <span>${item.label}</span>
                <span class="${results[item.id] ? "found" : "missing"}">
                    ${results[item.id] ? "✔ Found" : "✘ Missing"}
                </span>
            </div>
        `;
    });

    html += `</div>`;

    html += `
        <button id="signBtn" ${found === total ? "" : "disabled"}>
            Proceed to Signature
        </button>
        <p style="color: var(--red); font-size: 14px;">
            ${found === total ? "" : "Disclosure incomplete. Do NOT sign until missing items are fixed."}
        </p>
    `;

    container.innerHTML = html;

    if (found === total) {
        document.getElementById("signBtn").classList.add("enabled");
    }
}
</script>

</body>
</html>
